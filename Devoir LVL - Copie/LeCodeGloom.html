<!doctype html>
<html lang="en">
    <head>
        
        <meta charset="UTF-8" /><title>Gloom</title>
        <script src="//cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.js"></script>
        <style type="text/css"> body { margin: 0; }</style>
    </head>

    <body>
        <script type="text/javascript">

        var config = {
            type: Phaser.AUTO,
            width: 800, height: 800,
                physics: {
                    default: 'arcade',
                    arcade: {
                        gravity: { y: 300 },
                        debug: true,
                }},
        scene: {preload: preload, create: create, update: update }
        };

        new Phaser.Game(config);

        //Asset//
        function preload(){
            //Chargement du perso
            this.load.spritesheet('perso','asset/perso.png',{ 
                frameWidth: 32, frameHeight: 64 
            });

            this.load.image("Phaser_TILEDEDIT","asset/TILEDEDIT.png");
            this.load.tilemapTiledJSON("carte","asset/map.json");
            this.load.image('Bob', 'asset/Bob.png');
        };
    
        var player;

        function create(){
                // Affiche la map
                const carteDuNiveau = this.add.tilemap("carte");

                //Carte tuile
                const tileset = carteDuNiveau.addTilesetImage(
                "ets<stgg",
                "Phaser_TILEDEDIT" );  
                cursors = this.input.keyboard.createCursorKeys();

            //Calque Tiled//
            constond_8 = carteDuNiveau.createLayer(
                "Fond_8",
                tileset
                ); 

            const fond_7 = carteDuNiveau.createLayer(
                "Fond_7",
                tileset
                ); 

            const fond_6 = carteDuNiveau.createLayer(
                "Fond_6",
                tileset
                ); 

            const fond_5 = carteDuNiveau.createLayer(
                "Fond_5",
                tileset
                ); 

            const fond_4 = carteDuNiveau.createLayer(
                "Fond_4",
                tileset
                ); 

            const fond_3 = carteDuNiveau.createLayer(
                "Fond_3",
                tileset
                ); 

            const fond_2 = carteDuNiveau.createLayer(
                "Fond_2",
                tileset
                ); 

            const fond_1 = carteDuNiveau.createLayer(
                "Fond_1",
                tileset
                ); 

            const pied_3 = carteDuNiveau.createLayer(
                "Pied_3",
                tileset
                ); 

            const pied_2 = carteDuNiveau.createLayer(
                "Pied_2",
                tileset
                ); 

            const pied_1 = carteDuNiveau.createLayer(
                "Pied_1",
                tileset
                ); 

            const zone_danger = carteDuNiveau.createLayer(
                "Zone_danger",
                tileset
                ); 
                
            const eau = carteDuNiveau.createLayer(
                "Eau",
                tileset
                ); 

            const props = carteDuNiveau.createLayer(
                "Props",
                tileset
                ); 

            const props_zone_2 = carteDuNiveau.createLayer(
                "Props_zone_2",
                tileset
                ); 

            const colisio = carteDuNiveau.createLayer(
                "Colisio",
                tileset
                ); 

            const plateforme = carteDuNiveau.createLayer(
                "Plateforme",
                tileset
                ); 
                
            const herbe = carteDuNiveau.createLayer(
                "Herbe",
                tileset
                );
            
            const collectble = carteDuNiveau.createLayer(
                "collectble",
                tileset 
                );
            

        //Controle de Gloomi//
              //créer l'objet player et lui applique un rebond lors du collider
                player = this.physics.add.sprite(100,50,'perso');
                player.setCollideWorldBounds(true);
                player.setBounce(0.2);
                player.body.setGravityY(000);
                this.physics.add.collider(player,plateforme);
                this.physics.add.collider(player,colisio);
                
                //attribue a la variable cursors la / les touches appuyé
                cursors = this.input.keyboard.createCursorKeys(); 
                
                /*créer l'animation selon la touche definie dans le key.*/
                this.anims.create({
                    key:'left',
                    frames: this.anims.generateFrameNumbers('perso', {start: 0, end: 3}),
                    frameRate: 10,
                    repeat: -1
                });
                
                this.anims.create({
                    key:'stop',
                    frames: [{key: 'perso', frame:4}],
                    frameRate: 20
                });

                    //Faire en sorte qu'il saute

            //Colision

                    plateforme.setCollisionByProperty({ estSolide: true }); 
                    colisio.setCollisionByProperty({ estSolide: true }); 

                    this.physics.add.collider(player, plateforme, colisio); 

                //Camera
      /*  this.cameras.main.setSize(400, 300);

            const cam2 = this.cameras.add(400, 0, 400, 300);
            const cam3 = this.cameras.add(0, 300, 400, 300);
            const cam4 = this.cameras.add(400, 300, 400, 300);

            this.perso = this.add.image(450 + Math.cos(this.iter) * 200, 510 + Math.sin(this.iter) * 200, 'perso');

            this.cameras.main.startFollow(this.perso);

            cam2.startFollow(this.perso, false, 0.5, 0.5);
            cam3.startFollow(this.perso, false, 0.1, 0.1);
            cam4.startFollow(this.perso, false, 0.05, 0.05);
*/
        };

        function update(){

/*permet de créer la vérification des instances de l'objet cursors*/
        if(cursors.left.isDown){
            player.anims.play('left', true);
            player.setVelocityX(-300);
            player.setFlipX(false);
        }else if(cursors.right.isDown){
            player.setVelocityX(300);
            player.anims.play('left', true);
            player.setFlipX(true);
        }else{
            player.anims.play('stop', true);
            player.setVelocityX(0);
        }

        if(cursors.up.isDown && player.body.touching.down){
            player.setVelocityY(-330);
        } 

            
        }
        //A faire:
            //Bob le vilain
            //Perte de vie
            //Gain de vie
            //Score
            //Game over

        </script>
    </body>
</html>
